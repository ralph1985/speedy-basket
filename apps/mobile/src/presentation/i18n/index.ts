export type Language = 'es' | 'en';
export type TFunction = (key: string, params?: Record<string, string | number>) => string;

const translations: Record<Language, Record<string, string>> = {
  es: {
    'nav.list': 'Lista',
    'nav.map': 'Mapa',
    'nav.dev': 'Dev',
    'nav.settings': 'Configuracion',
    'header.stores': 'Tiendas',
    'header.lastSync': 'Ultimo sync',
    'header.error': 'Error',
    'header.api': 'API',
    'syncStatus.idle': 'idle',
    'syncStatus.ok': 'ok',
    'syncStatus.failed': 'fallo',
    'status.initializing': 'Inicializando...',
    'status.sqliteReady': 'SQLite lista',
    'status.sqliteInitFailed': 'Fallo al iniciar SQLite',
    'status.eventSaved': 'Evento {type} guardado',
    'status.resetPack': 'BD reiniciada + pack importado',
    'status.syncing': 'Sincronizando...',
    'status.syncRetry': 'Reintento de sync {attempt}/{max}...',
    'status.syncOkNoChanges': 'Sync ok (sin cambios)',
    'status.syncOkEvents': 'Sync ok ({accepted} eventos)',
    'status.syncFailed': 'Sync fallido: {message}',
    'label.zone': 'Zona',
    'label.activeZone': 'Zona activa',
    'label.suggestedZone': 'Zona sugerida',
    'label.category': 'Categoria',
    'action.found': 'Encontrado',
    'action.notFound': 'No esta',
    'action.backToList': 'Volver a lista',
    'action.refresh': 'Refrescar',
    'action.resetPack': 'Reset + Import pack',
    'action.syncNow': 'Sincronizar ahora',
    'action.syncing': 'Sincronizando...',
    'search.placeholder': 'Buscar producto',
    'dev.title': 'Developer mode',
    'dev.apiBase': 'API base',
    'dev.dbCounts': 'DB counts',
    'dev.lastSyncStats': 'Last sync stats',
    'dev.noSyncStats': 'Sin stats de sync todavia.',
    'dev.outboxPending': 'Outbox pendientes',
    'dev.outboxSent': 'Outbox enviados (ultimos 20)',
    'dev.section.overview': 'Resumen',
    'dev.section.sync': 'Sync',
    'dev.section.outbox': 'Outbox',
    'settings.title': 'Configuracion',
    'settings.language': 'Idioma',
    'language.es': 'Espanol',
    'language.en': 'Ingles',
    'eventType.FOUND': 'Encontrado',
    'eventType.NOT_FOUND': 'No esta',
  },
  en: {
    'nav.list': 'List',
    'nav.map': 'Map',
    'nav.dev': 'Dev',
    'nav.settings': 'Settings',
    'header.stores': 'Stores',
    'header.lastSync': 'Last sync',
    'header.error': 'Error',
    'header.api': 'API',
    'syncStatus.idle': 'idle',
    'syncStatus.ok': 'ok',
    'syncStatus.failed': 'failed',
    'status.initializing': 'Initializing...',
    'status.sqliteReady': 'SQLite ready',
    'status.sqliteInitFailed': 'SQLite init failed',
    'status.eventSaved': 'Event {type} saved',
    'status.resetPack': 'DB reset + pack imported',
    'status.syncing': 'Syncing...',
    'status.syncRetry': 'Sync retry {attempt}/{max}...',
    'status.syncOkNoChanges': 'Sync ok (no changes)',
    'status.syncOkEvents': 'Sync ok ({accepted} events)',
    'status.syncFailed': 'Sync failed: {message}',
    'label.zone': 'Zone',
    'label.activeZone': 'Active zone',
    'label.suggestedZone': 'Suggested zone',
    'label.category': 'Category',
    'action.found': 'Found',
    'action.notFound': 'Not found',
    'action.backToList': 'Back to list',
    'action.refresh': 'Refresh',
    'action.resetPack': 'Reset + Import pack',
    'action.syncNow': 'Sync now',
    'action.syncing': 'Syncing...',
    'search.placeholder': 'Search product',
    'dev.title': 'Developer mode',
    'dev.apiBase': 'API base',
    'dev.dbCounts': 'DB counts',
    'dev.lastSyncStats': 'Last sync stats',
    'dev.noSyncStats': 'No sync stats yet.',
    'dev.outboxPending': 'Pending outbox',
    'dev.outboxSent': 'Sent outbox (last 20)',
    'dev.section.overview': 'Overview',
    'dev.section.sync': 'Sync',
    'dev.section.outbox': 'Outbox',
    'settings.title': 'Settings',
    'settings.language': 'Language',
    'language.es': 'Spanish',
    'language.en': 'English',
    'eventType.FOUND': 'Found',
    'eventType.NOT_FOUND': 'Not found',
  },
};

export const isLanguage = (value: string | null): value is Language =>
  value === 'es' || value === 'en';

export const createTranslator = (language: Language): TFunction => {
  return (key, params) => {
    const template = translations[language][key] ?? key;
    if (!params) return template;
    return Object.entries(params).reduce((result, [param, value]) => {
      return result.replaceAll(`{${param}}`, String(value));
    }, template);
  };
};
